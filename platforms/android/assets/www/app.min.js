angular.module("tasks",["ui.router","kinvey"]),angular.module("tasks").controller("tasksController",["$rootScope","$scope","$state","$kinvey","tasks","notify",function(o,e,t,n,r,a){if(!o.activeUser)return null;var i=[];if(e.tasks=r,o.activeUser.admin)for(var l=0;l<=r.length-1;l++)r[l].creator&&r[l].creator.name&&i.indexOf(r[l].creator.name)<0&&i.push(r[l].creator.name);else i.push(o.activeUser.name);e.users=i,e.toLocale=function(o){var e=new Date(o);return e.toLocaleDateString()},e.approve=function(o,e){var t={_id:e.approval._id,approved:o};n.DataStore.save("task-approval",t).then(function(o){console.log("Task approval/disapproval success"),e.approval=t},function(o){console.log("Could not approve the task!... see the error log below..."),console.log(o),a(o.description)})}}]).controller("addTaskController",["$rootScope","$scope","$state","$kinvey",function(o,e,t,n){e.addTask=function(){if(e.addTaskForm.taskName.$error.required||e.addTaskForm.startDate.$error.required||e.addTaskForm.endDate.$error.required)return null;var r={task_name:e.task.name,start_date:e.task.startDate,end_date:e.task.endDate,comments:e.task.comments,creator:o.activeUser};n.DataStore.save("tasks",r,{exclude:["creator"],relations:{creator:"user"}}).then(function(){t.go("root.tasks",{},{reload:!0})},function(o){console.log("There seems to be a problem adding the task!...see the error log below..."),console.log(o),notify(o.description)})}}]),angular.module("tasks").config(["$stateProvider","$urlRouterProvider",function(o,e){o.state("root.tasks",{url:"/tasks",resolve:{tasks:["$rootScope","$kinvey",function(o,e){return o.activeUser?e.DataStore.find("tasks",null,{relations:{approval:"task-approval",creator:"user"}}).then(function(o){return console.log("Fetched records"),o},function(o){console.log("Some error fetching the records!...see log below..."),console.log(o)}):[]}]},views:{"header@root":{templateUrl:"partials/tasks-header.html"},"section@root":{templateUrl:"partials/tasks.html",controller:"tasksController"}}}).state("root.tasks.addtask",{url:"/addtask",views:{"section@root":{templateUrl:"partials/add-task.html",controller:"addTaskController"}}})}]),angular.module("login",["ui.router","kinvey"]),angular.module("login").run(["$kinvey","$state","$rootScope",function(o,e,t){o.init({appKey:"kid_Wk8MsXwikg",appSecret:"68c9a63e8a4a41b98898796652bfccc5"}).then(function(o){t.activeUser=o,null===o?(console.log("Kinvey initalized with no active user...redirecting to login page"),e.go("root.login")):(console.log("Kinvey initalized with an active user...redirecting to tasks page"),e.go("root.tasks",{},{reload:!0}))},function(o){console.log("Kinvey could not be initalized ...determining behaviour"),"EmailVerificationRequired"===o.name?(t.activeUser=!1,console.log("The user has not clicked on the link that was sent through email..."),e.go("root.login")):(console.log("Unable to resolve behaviour...see error log below"),console.log(o))})}]),angular.module("main",["ui.router","kinvey","tasks","login"]),angular.module("main").factory("notify",["$timeout",function(o){return function(e){$notify=$(".notify"),0===$notify.length&&($notify=$("body").append('<div class="notify"></div>'),$notify=$(".notify")),$notify.text(e).addClass("notify-shown"),o(function(){$notify.removeClass("notify-shown")},3e3)}}]),angular.module("main").config(["$stateProvider","$urlRouterProvider",function(o,e){e.otherwise("/"),o.state("root",{views:{body:{templateUrl:"partials/body.html"}}})}]),angular.module("login").controller("loginController",["$rootScope","$scope","$state","$kinvey","notify",function(o,e,t,n,r){e.login=function(){return e.loginForm.username.$error.required||e.loginForm.password.$error.required?null:void n.User.login({username:e.user.username,password:e.user.pwd}).then(function(e){console.log("Successfully logged in!"),o.activeUser=e,t.reload()},function(o){console.log("Error logging in!"),console.log(o),r(o.description)})},e.logout=function(){n.User.logout().then(function(){console.log("Successfully logged out!"),o.activeUser=null,t.reload()},function(o){console.log("Some problem logging out...try again!"),console.log(o),r(o.description)})},e.confirm=function(){n.User.me().then(function(e){console.log("User confirmed the email"),o.activeUser=e,t.reload()},function(o){console.log("Some problem confirming the user out...try again!"),console.log(o),r(o.description)})}}]).controller("signupController",["$rootScope","$scope","$state","$kinvey","notify",function(o,e,t,n,r){e.signup=function(){return e.signupForm.$invalid?null:void n.User.signup({username:e.user.username,password:e.user.pwd,name:e.user.name,email:e.user.email}).then(function(e){console.log("Successfully signed up...need email verfication!"),o.activeUser=!1,t.go("root.login")},function(o){console.log("Error sign up!...check error log below"),console.log(o),r(o.description)})}}]),angular.module("login").config(["$stateProvider",function(o){o.state("root.login",{url:"/login",views:{"header@root":{templateUrl:"partials/login-header.html"},"section@root":{templateUrl:"partials/login.html",controller:"loginController"}}}).state("root.signup",{url:"/signup",views:{"header@root":{templateUrl:"partials/signup-header.html"},"section@root":{templateUrl:"partials/signup.html",controller:"signupController"}}})}]);var environment=function(){var o="browser";return{agent:o,readyEvent:"webview"===o?"deviceready":"DOMContentLoaded"}}();console.log("environment "+JSON.stringify(environment));var app=new function(){function o(){console.log("Bootstrapping angular on main module..."),angular.bootstrap(document,["main"])}function e(){console.log("Ready event binding"),document.addEventListener(environment.readyEvent,o,!1)}return{initialize:function(){console.log("Initializing app by binding handlers to different events that the app responds to..."),e()}}};app.initialize();